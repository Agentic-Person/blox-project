# Agent 1: Type System Architect
> Unified Type Definitions for AI-Powered Learning System Integration
> **Agent Role**: Type System & Data Model Specialist
> **Time Allocation**: 2 hours
> **Dependencies**: None (can start immediately)

---

## üéØ Mission Statement

You are responsible for creating the foundational type system that will unify the Blox Wizard (transcript/chat) and Todo/Calendar systems. Your work will be used by all other agents, so accuracy and completeness are critical.

---

## üìã Task List

### Task 1.1: Create Shared Types Module (45 minutes)
**File**: `src/types/shared.ts`

Create a new file with unified interfaces that both systems will use:

```typescript
// Unified video reference that works across both systems
export interface UnifiedVideoReference {
  // Core fields (required by both systems)
  videoId: string
  youtubeId: string
  title: string
  thumbnailUrl: string
  creatorName?: string
  
  // Blox Wizard specific fields
  timestamp?: string           // "15:30" format
  timestampSeconds?: number     // 930 (for 15:30)
  relevantSegment?: string      // The matching transcript text
  confidence?: number           // 0-1 relevance score
  transcriptChunkId?: string    // Reference to specific chunk
  
  // Todo system specific fields
  duration?: number             // Total video duration in seconds
  watchProgress?: number        // 0-100 percentage watched
  linkedTodoIds?: string[]      // Related todos
  learningObjectives?: string[] // What the video teaches
  
  // Shared metadata
  videoUrl?: string             // Full YouTube URL
  timestampUrl?: string         // URL with timestamp parameter
  addedAt?: string             // ISO date when linked
  lastWatched?: string         // ISO date of last view
}

// Extended chat response with todo/calendar integration
export interface UnifiedChatResponse {
  // Core Blox Wizard fields
  answer: string
  videoReferences: UnifiedVideoReference[]
  suggestedQuestions: string[]
  sessionId: string
  responseTime: number
  
  // New integration fields
  suggestedTodos?: TodoSuggestion[]
  schedulingActions?: CalendarAction[]
  learningPath?: LearningPathSegment[]
  actionButtons?: ActionButton[]
  
  // Metadata
  metadata: {
    cacheHit: boolean
    searchResultsCount: number
    confidence: number
    tokensUsed?: number
    intent?: DetectedIntent
  }
}

// Todo suggestion from AI
export interface TodoSuggestion {
  title: string
  description?: string
  priority: 'low' | 'medium' | 'high' | 'urgent'
  category: 'practice' | 'learn' | 'build' | 'review' | 'other'
  estimatedMinutes: number
  videoReferences: UnifiedVideoReference[]
  suggestedDueDate?: string
  prerequisites?: string[]
  learningObjectives?: string[]
  autoGenerated: boolean
  confidence: number
}

// Calendar scheduling action
export interface CalendarAction {
  type: 'schedule_video' | 'schedule_practice' | 'schedule_review' | 'block_time'
  title: string
  description?: string
  startTime?: string  // ISO datetime
  endTime?: string    // ISO datetime
  duration: number    // minutes
  recurring?: RecurringPattern
  videoReference?: UnifiedVideoReference
  relatedTodos?: string[]
}

// Learning path segment
export interface LearningPathSegment {
  id: string
  order: number
  title: string
  description: string
  type: 'video' | 'practice' | 'project' | 'quiz'
  estimatedMinutes: number
  videoReferences: UnifiedVideoReference[]
  prerequisites: string[]
  objectives: string[]
  completed: boolean
  completedAt?: string
}

// Action button for chat UI
export interface ActionButton {
  id: string
  label: string
  icon?: string
  action: ChatAction
  variant: 'primary' | 'secondary' | 'ghost'
  disabled?: boolean
  tooltip?: string
}

// Chat action that can be executed
export interface ChatAction {
  type: 'CREATE_TODO' | 'SCHEDULE_VIDEO' | 'START_LEARNING_PATH' | 'TRACK_PROGRESS' | 'VIEW_TRANSCRIPT'
  payload: Record<string, any>
  requiresConfirmation?: boolean
}

// Detected user intent from message
export interface DetectedIntent {
  primary: 'question' | 'schedule' | 'todo' | 'learn' | 'track' | 'general'
  secondary?: string[]
  confidence: number
  extractedEntities?: {
    timeReferences?: string[]
    videoReferences?: string[]
    concepts?: string[]
    actions?: string[]
  }
}

// Recurring pattern for calendar events
export interface RecurringPattern {
  frequency: 'daily' | 'weekly' | 'monthly'
  interval: number  // Every N days/weeks/months
  daysOfWeek?: number[]  // 0-6 for weekly
  endDate?: string  // When recurrence ends
  maxOccurrences?: number  // Or limit by count
}

// Integration link between todo and video
export interface TodoVideoLink {
  id: string
  todoId: string
  videoReference: UnifiedVideoReference
  linkType: 'reference' | 'requirement' | 'output'
  addedAt: string
  addedBy: 'user' | 'ai' | 'system'
  notes?: string
}

// Progress sync event
export interface ProgressSyncEvent {
  type: 'video_watched' | 'todo_completed' | 'path_advanced' | 'milestone_reached'
  userId: string
  timestamp: string
  source: 'video_player' | 'todo_system' | 'calendar' | 'chat'
  data: Record<string, any>
  relatedEntities: {
    videoIds?: string[]
    todoIds?: string[]
    pathIds?: string[]
  }
}
```

### Task 1.2: Update Blox Wizard Types (30 minutes)
**File**: `src/types/blox-wizard.ts`

Update existing types to extend shared interfaces:

```typescript
import { 
  UnifiedVideoReference, 
  UnifiedChatResponse,
  DetectedIntent 
} from './shared'

// Extend VideoReference to use UnifiedVideoReference
export interface VideoReference extends UnifiedVideoReference {
  // All fields now inherited from UnifiedVideoReference
  // Add any Blox-specific fields here if needed
}

// Update ChatResponse to use UnifiedChatResponse
export interface ChatResponse extends UnifiedChatResponse {
  // All integration fields now available
  // Keep backward compatibility
}

// Keep existing types but ensure compatibility
export interface ChatRequest {
  message: string
  sessionId: string
  userId?: string
  videoContext?: {
    videoId: string
    youtubeId: string
    currentTime?: number
  }
  preferences?: {
    maxVideos?: number
    difficulty?: 'beginner' | 'intermediate' | 'advanced'
    focusAreas?: string[]
    enableTodoSuggestions?: boolean  // New
    enableScheduling?: boolean       // New
  }
}

// Update SearchResult to include todo hints
export interface SearchResult {
  chunkId: string
  transcriptId: string
  videoId: string
  youtubeId: string
  title: string
  creator?: string
  chunkText: string
  startTimestamp: string
  endTimestamp: string
  relevanceScore: number
  confidence: number
  videoUrl: string
  timestampUrl: string
  
  // New fields for integration
  suggestedTodoTitles?: string[]
  learningObjectives?: string[]
  practiceOpportunities?: string[]
}
```

### Task 1.3: Update Todo System Types (30 minutes)
**File**: `src/types/todo.ts`

Update todo types to use unified video references:

```typescript
import { 
  UnifiedVideoReference,
  TodoSuggestion,
  TodoVideoLink,
  ProgressSyncEvent 
} from './shared'

// Update VideoReference to use unified type
export type VideoReference = UnifiedVideoReference

// Extend Todo interface with integration fields
export interface Todo {
  id: string
  userId: string
  journeyId?: string
  title: string
  description?: string
  status: TodoStatus
  priority: TodoPriority
  category?: string
  dueDate?: string
  completedAt?: string
  
  // Updated to use UnifiedVideoReference
  videoReferences: UnifiedVideoReference[]
  
  // New integration fields
  transcriptChunkIds?: string[]
  generatedFrom?: 'user' | 'ai' | 'video' | 'learning_path'
  aiSuggestion?: TodoSuggestion
  syncedWithCalendar?: boolean
  
  tags: string[]
  estimatedMinutes?: number
  actualMinutes?: number
  parentTodoId?: string
  templateId?: string
  metadata: Record<string, any>
  createdAt: string
  updatedAt: string
}

// Add new interfaces for integration
export interface TodoGenerationRequest {
  source: 'chat' | 'video' | 'transcript' | 'learning_path'
  videoReference?: UnifiedVideoReference
  transcriptText?: string
  userLevel: 'beginner' | 'intermediate' | 'advanced'
  objectives?: string[]
  autoSchedule?: boolean
}

export interface TodoVideoSyncStatus {
  todoId: string
  videoId: string
  lastSynced: string
  watchProgress: number
  autoComplete: boolean
  completionThreshold: number  // % of video to watch
}

// Calendar integration types
export interface TodoCalendarEvent {
  todoId: string
  eventId: string
  scheduledFor: string
  duration: number
  reminderMinutes?: number
  recurring?: boolean
  videoSession?: {
    youtubeId: string
    startTimestamp?: string
    endTimestamp?: string
  }
}
```

### Task 1.4: Create Migration Types (15 minutes)
**File**: `src/types/migrations.ts`

Define types for database migrations:

```typescript
// Database migration types for integration
export interface TodoVideoLinkRow {
  id: string
  todo_id: string
  video_id: string
  youtube_id: string
  timestamp_start?: string
  timestamp_end?: string
  relevance_score?: number
  link_type: 'reference' | 'requirement' | 'output'
  created_at: string
  created_by: 'user' | 'ai' | 'system'
}

export interface VideoProgressRow {
  id: string
  user_id: string
  youtube_id: string
  watch_progress: number  // 0-100
  last_position: number   // seconds
  total_duration: number  // seconds
  completed: boolean
  completed_at?: string
  updated_at: string
}

export interface LearningPathVideoRow {
  id: string
  path_id: string
  video_id: string
  youtube_id: string
  order_index: number
  is_required: boolean
  is_completed: boolean
  completed_at?: string
}

export interface ProgressSyncLogRow {
  id: string
  event_type: string
  user_id: string
  event_data: Record<string, any>
  source_system: string
  processed: boolean
  processed_at?: string
  created_at: string
}
```

---

## üìÅ File Structure You'll Create

```
src/
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îú‚îÄ‚îÄ shared.ts          ‚ú® NEW - Unified types (Task 1.1)
‚îÇ   ‚îú‚îÄ‚îÄ blox-wizard.ts     üìù UPDATE - Extend shared (Task 1.2)
‚îÇ   ‚îú‚îÄ‚îÄ todo.ts            üìù UPDATE - Use unified (Task 1.3)
‚îÇ   ‚îî‚îÄ‚îÄ migrations.ts      ‚ú® NEW - DB migration types (Task 1.4)
```

---

## ‚úÖ Success Criteria

Your work is complete when:

1. **All shared types are defined** in `shared.ts`
2. **Both systems' types are updated** to use shared interfaces
3. **No type conflicts** between systems
4. **TypeScript compiles** without errors
5. **All fields are properly documented** with JSDoc comments
6. **Migration types match** database schema

---

## üîÑ Coordination Points

### Checkpoint 1 (30 minutes)
Share your `shared.ts` draft with other agents for validation

### Checkpoint 2 (1 hour)
Confirm type compatibility with Agent 2 (Service Builder)

### Checkpoint 3 (1.5 hours)
Validate UI types with Agent 3 (UI Engineer)

### Final (2 hours)
Complete all types and ensure compilation

---

## üìù Testing Your Work

Run these commands to validate:

```bash
# Type checking
npm run typecheck

# Build test
npm run build

# Ensure no type errors
npx tsc --noEmit
```

---

## üöÄ Getting Started

1. Create the `src/types/shared.ts` file first
2. Copy the provided interfaces
3. Add JSDoc comments for clarity
4. Update existing type files to import and extend
5. Test compilation frequently

---

## ‚ö†Ô∏è Important Notes

- **DO NOT** delete existing types, only extend them
- **MAINTAIN** backward compatibility
- **DOCUMENT** all new fields with comments
- **USE** strict TypeScript settings
- **COORDINATE** with other agents on shared interfaces

---

## üéØ Deliverables Checklist

- [ ] `src/types/shared.ts` created with all unified types
- [ ] `src/types/blox-wizard.ts` updated to extend shared types
- [ ] `src/types/todo.ts` updated to use UnifiedVideoReference
- [ ] `src/types/migrations.ts` created with DB types
- [ ] All TypeScript compilation errors resolved
- [ ] JSDoc comments added to all interfaces
- [ ] Coordination checkpoints completed

---

**Agent 1 Ready to Deploy!**
Start with Task 1.1 and work through sequentially. Your types are the foundation for all other agents' work.